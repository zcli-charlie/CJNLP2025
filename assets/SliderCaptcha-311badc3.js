import{_ as H,C as W,r as s,s as _,b as A,J as F,y as h,e as t,t as J,d as f,u as E,M as U,i as q,w as L,x as M,n as w,c as G,N as K,j as O,p as i}from"./index-188471f6.js";import{j as Q,k as R}from"./index-de848205.js";const Y={class:"dialog-title"},Z={class:"captcha-container relative"},ee={class:"image-wrapper"},ae=["src"],te=["src"],se={class:"slider-track"},le={key:0,class:"captcha-loading-mask"},oe={class:"captcha-loading-spinner"},ne={__name:"SliderCaptcha",props:{lang:{type:String,default:"zh"}},setup($,{expose:D}){const l=$,P=W(()=>l.lang==="zh"?"请完成验证码":l.lang==="en"?"Please complete the CAPTCHA":"CAPTCHA を入力してください"),u=s(!1),y=s(""),C=s(""),b=s(""),o=s(0),x=s(0),k=s(0),m=s(!1),n=s(!1),r=s(!1);let I=null;const j=(e,a)=>new Promise(c=>{let v=0;const p=()=>{v++,v===2&&c()},g=new Image,z=new Image;g.onload=p,z.onload=p,g.src=e,z.src=a}),d=async()=>{n.value=!0,r.value=!1;try{const e=await R();y.value=e.captcha_id;const a=e.bg_image.startsWith("data:")?e.bg_image:`data:image/png;base64,${e.bg_image}`,c=e.slider_image.startsWith("data:")?e.slider_image:`data:image/png;base64,${e.slider_image}`;C.value=a,b.value=c,x.value=e.height?e.height-12:0,o.value=0,await j(a,c),r.value=!0}catch{l.lang==="zh"?i.error("加载验证码失败"):l.lang==="en"?i.error("Failed to load captcha"):l.lang==="ja"&&i.error("キャプチャの読み込みに失敗しました"),await d()}finally{n.value=!1}},B=async()=>{await d()},N=e=>{!r.value||n.value||(m.value=!0,k.value=e.clientX-o.value,document.addEventListener("mousemove",S),document.addEventListener("mouseup",V))},S=e=>{if(!m.value)return;let a=e.clientX-k.value;a=Math.max(0,Math.min(a,280)),o.value=a},V=async()=>{m.value=!1,document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",V),await T()},X=async()=>(u.value=!0,await d(),new Promise(e=>{I=e})),T=async()=>{var e;n.value=!0;try{const a=await Q({captcha_id:y.value,distance:Math.round(o.value)+20});a==="验证成功"||((e=a==null?void 0:a.data)==null?void 0:e.code)===200?(u.value=!1,I(!0)):(l.lang==="zh"?i.error("验证失败，请重试"):l.lang==="en"?i.error("Verification failed, please try again"):l.lang==="ja"&&i.error("認証に失敗しました。もう一度お試しください。"),await d())}catch{await d()}finally{n.value=!1}};return D({show:X}),(e,a)=>{const c=_("el-button"),v=_("el-icon"),p=_("el-dialog");return A(),F(p,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=g=>u.value=g),width:"360px","show-close":!1,"lock-scroll":!0},{header:h(()=>[t("div",Y,[t("span",null,J(P.value),1),f(c,{link:"",type:"primary",icon:E(U),onClick:B},null,8,["icon"])])]),default:h(()=>[t("div",Z,[t("div",{class:q(["captcha-box",{"pointer-events-none":n.value}])},[t("div",ee,[L(t("img",{src:C.value,class:"bg-img"},null,8,ae),[[M,r.value]]),L(t("img",{src:b.value,class:"slider-img",style:w({left:`${o.value}px`,top:`${x.value}px`})},null,12,te),[[M,r.value]])]),t("div",se,[t("div",{class:"slider-fill",style:w({width:`${o.value+20}px`})},null,4),t("div",{class:"slider-button",style:w({left:`${o.value}px`}),onMousedown:N}," ⇆ ",36)])],2),n.value?(A(),G("div",le,[t("div",oe,[f(v,{class:"is-loading"},{default:h(()=>[f(E(K))]),_:1})])])):O("",!0)])]),_:1},8,["modelValue"])}}},re=H(ne,[["__scopeId","data-v-1a5ff20c"]]);export{re as S};
