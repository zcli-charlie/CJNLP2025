<template>
  <div class="submission-container">
    <div class="content-wrapper">
      <h1>æŠ¥å‘Šæäº¤</h1>

      <!-- Call for Papers -->
      <section class="cfp-section">
        <h2>ğŸ“¢ æŠ¥å‘Šå¾é›†</h2>
        <div class="cfp-content">
          <div class="topics">
            <h3>ğŸ“š å¾ç¨¿ä¸»é¢˜</h3>
            <p>æœ¬æ¬¡ä¼šè®®æ¥å—ä»¥ä¸‹æ–¹å‘çš„æŠ¥å‘Š/æµ·æŠ¥ï¼š</p>
            <ul>
              <li class="highlight-topic">å¤§å‹è¯­è¨€æ¨¡å‹ - æ¢ç´¢LLMå‰æ²¿æŠ€æœ¯ä¸åº”ç”¨</li>
              <li class="highlight-topic">æ™ºèƒ½ä½“æŠ€æœ¯ - å¤šæ™ºèƒ½ä½“åä½œä¸åº”ç”¨åˆ›æ–°</li>
              <li>è‡ªç„¶è¯­è¨€ç†è§£ - æ–‡æœ¬ç†è§£ä¸è¯­ä¹‰åˆ†ææŠ€æœ¯</li>
              <li>æœºå™¨ç¿»è¯‘ - å¤šè¯­è¨€ç¿»è¯‘ä¸è·¨è¯­è¨€ç ”ç©¶</li>
              <li>å¯¹è¯ç³»ç»Ÿ - æ™ºèƒ½å¯¹è¯ä¸äººæœºäº¤äº’</li>
              <li>ä¿¡æ¯æŠ½å– - ä»éç»“æ„åŒ–æ–‡æœ¬ä¸­è·å–ç»“æ„åŒ–ä¿¡æ¯</li>
              <li>å¤šæ¨¡æ€å¤„ç† - è·¨æ¨¡æ€ç†è§£ä¸ç”Ÿæˆ</li>
              <li>çŸ¥è¯†å›¾è°± - çŸ¥è¯†è¡¨ç¤ºã€æ¨ç†ä¸åº”ç”¨</li>
              <li>è¯­è¨€èµ„æº - äºšæ´²è¯­è¨€èµ„æºæ„å»ºä¸åˆ©ç”¨</li>
            </ul>
          </div>

          <div class="requirements">
            <h3>ğŸ“‹ æäº¤è¦æ±‚</h3>
            <p class="general-requirement">æŠ¥å‘Š/æµ·æŠ¥å¯ä»¥å·²ç»å‘è¡¨</p>
            

            <div class="requirement-item">
              <h4>æŠ¥å‘Šè¦æ±‚</h4>
              <ul>
                <li>éœ€ä½¿ç”¨æ ‡å‡†PPTæ¨¡æ¿</li>
                <li>æŠ¥å‘Šæ—¶é•¿15-20åˆ†é’Ÿ</li>
              </ul>
              <a href="/uploads/templates/presentation_template.pptx" class="template-btn" download>
                <span class="icon">ğŸ“¥</span>
                ä¸‹è½½PPTæ¨¡æ¿
              </a>
            </div>

            <div class="requirement-item">
              <h4>æµ·æŠ¥è¦æ±‚</h4>
              <ul>
                <li>A0çºµå‘</li>
                <li>åˆ†è¾¨ç‡ï¼š300 DPI</li>
              </ul>
              <a href="/uploads/templates/presentation_template.pptx" class="template-btn" download>
                <span class="icon">ğŸ“¥</span>
                ä¸‹è½½æµ·æŠ¥æ¨¡æ¿
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- ä½œè€…æŒ‡å— -->
      <section class="author-guidelines">
        <h2>ğŸ“ ä½œè€…æŒ‡å—</h2>
        <div class="guidelines-content">
          <div class="guideline-item">
            <h3>ğŸ“… é‡è¦æ—¥æœŸ</h3>
            <ul class="date-list">
              <li><span class="date-label">æŠ•ç¨¿æˆªæ­¢æ—¥æœŸ:</span> <span class="date-value">{{ config?.submission_time || '2025å¹´4æœˆ15æ—¥' }}</span></li>
              <li><span class="date-label">å½•å–é€šçŸ¥æ—¥æœŸ:</span> <span class="date-value">{{ config?.notification_time || '2025å¹´9æœˆ1æ—¥' }}</span></li>
              <li><span class="date-label">ä¼šè®®æ—¥æœŸ:</span> <span class="date-value">{{ config?.conference_time || '2025å¹´9æœˆ13-14æ—¥' }}</span></li>
            </ul>
          </div>

          <!-- <div class="guideline-item">
            <h3>âœï¸ æ’°å†™æŒ‡å—</h3>
            <p>ä¸ºç¡®ä¿æ‚¨çš„æŠ¥å‘Š/æµ·æŠ¥é¡ºåˆ©é€šè¿‡è¯„å®¡ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
            <ul>
              <li>ä¸¥æ ¼éµå¾ªæä¾›çš„æ¨¡æ¿æ ¼å¼</li>
              <li>ç¡®ä¿å†…å®¹æ¸…æ™°ã€é€»è¾‘è¿è´¯</li>
              <li>å›¾è¡¨é¡»é«˜è´¨é‡ï¼Œä¸”åŒ…å«é€‚å½“è¯´æ˜</li>
              <li>å‚è€ƒæ–‡çŒ®æ ¼å¼è§„èŒƒï¼Œå¼•ç”¨å‡†ç¡®</li>
              <li>æ ¡å¯¹æ–‡ç« ï¼Œé¿å…è¯­æ³•å’Œæ‹¼å†™é”™è¯¯</li>
            </ul>
          </div>

          <div class="guideline-item">
            <h3>ğŸ” è¯„å®¡æµç¨‹</h3>
            <p>æ‰€æœ‰æäº¤å°†ç»è¿‡ä»¥ä¸‹è¯„å®¡æµç¨‹ï¼š</p>
            <ol>
              <li>åˆå®¡ï¼šæ£€æŸ¥æ ¼å¼è§„èŒƒæ€§å’Œå†…å®¹ç›¸å…³æ€§</li>
              <li>åŒè¡Œè¯„å®¡ï¼šç”±è‡³å°‘ä¸¤ä½é¢†åŸŸä¸“å®¶è¿›è¡ŒåŒ¿åè¯„å®¡</li>
              <li>ç»ˆå®¡ï¼šæ ¹æ®è¯„å®¡æ„è§ä½œå‡ºæœ€ç»ˆå½•å–å†³å®š</li>
            </ol>
            <p>è¯„å®¡æ ‡å‡†åŒ…æ‹¬ï¼šåˆ›æ–°æ€§ã€æŠ€æœ¯æ·±åº¦ã€å®éªŒå……åˆ†æ€§ã€è¡¨è¾¾æ¸…æ™°åº¦ç­‰</p>
          </div> -->

          <div class="guideline-item">
            <h3>ğŸ–ï¸ ä¼˜ç§€è®²è€…è¯„é€‰</h3>
            <p>ä¼šè®®å°†è¯„é€‰ä¼˜ç§€è®²è€…è‹¥å¹²äººï¼Œè·å¥–è®²è€…å°†ï¼š</p>
            <ul>
              <li>è·å¾—ä¼˜ç§€è®²è€…è¯ä¹¦</li>
              <li>åœ¨ä¼šè®®å®˜ç½‘è¿›è¡Œå±•ç¤º</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- æäº¤è¡¨å• -->
      <section class="submission-form" v-loading="loading">
        <h2>ğŸ“¤ æŠ¥å‘Šæäº¤</h2>
        <form @submit.prevent="handleSubmit">
          <div class="form-group">
            <label for="title">æŠ¥å‘Š/æµ·æŠ¥æ ‡é¢˜</label>
            <input type="text" id="title" v-model="form.title" required>
          </div>

          <div class="form-group">
            <label for="submitType">æäº¤ç±»å‹</label>
            <select id="submitType" v-model="form.submitType" required>
              <option value="">è¯·é€‰æ‹©æäº¤ç±»å‹</option>
              <option :value="2">æŠ¥å‘Š</option>
              <option :value="3">æµ·æŠ¥</option>
            </select>
          </div>

          <div class="form-group">
            <label for="authors">ä½œè€…ä¿¡æ¯</label>
            <textarea id="authors" v-model="form.authors" rows="3" required
              placeholder="è¯·æŒ‰é¡ºåºåˆ—å‡ºæ‰€æœ‰ä½œè€…å§“åã€å•ä½å’Œé‚®ç®±ï¼Œæ¯è¡Œä¸€ä¸ªä½œè€…"></textarea>
          </div>

          <div class="form-group">
            <label for="abstract">æ‘˜è¦</label>
            <textarea id="abstract" v-model="form.abstract" rows="4" required></textarea>
          </div>

          <div class="form-group">
            <label for="keywords">å…³é”®è¯</label>
            <input type="text" id="keywords" v-model="form.keywords" required
              placeholder="è¯·ç”¨é€—å·åˆ†éš”å…³é”®è¯">
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input type="text" id="email" v-model="form.email" required
              placeholder="Please enter your email">
          </div>

          <div class="form-group">
            <label for="fileUrl">ä¸Šä¼ æ–‡ä»¶</label>
            <div class="file-upload">
              <input  type="file" id="file" @change="handleFileChange" required
                     accept=".pdf">
              <p class="file-hint">æ”¯æŒPDFæ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡10MB</p>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="submit-btn">æäº¤</button>
          </div>
        </form>
      </section>
    </div>
  </div>
  <SliderCaptcha ref="captchaRef"/>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import {postUploadApi,postAddThesisApi,getConfigApi} from '../api/index'
import {ElMessage} from "element-plus";
import SliderCaptcha from '../components/SliderCaptcha.vue'
import { getRequest } from '../utils/request'


const captchaRef = ref(null)

const form = ref({
  year: '2025',
  title: '',
  submitType: '',
  authors: '',
  abstract: '',
  keywords: '',
  fileUrl:'',
  email:''
})

const loading = ref(false)
const config = ref(null)

const fetchConfig = async () => {
  try {
    const configData = await getConfigApi()
    if (configData) {
      config.value = configData
      // å°†é…ç½®æ•°æ®å­˜å‚¨åœ¨localStorageä¸­
      localStorage.setItem('siteConfig', JSON.stringify(configData))
    }
    return configData
  } catch (error) {
    console.error('Failed to fetch config data:', error)
    return null
  }
}

onMounted(async () => {
  // ä»localStorageä¸­è·å–é…ç½®æ•°æ®
  const configData = localStorage.getItem('siteConfig')
  if (configData) {
    try {
      config.value = JSON.parse(configData)
    } catch (error) {
      console.error('Failed to parse config data:', error)
      await fetchConfig()
    }
  } else {
    await fetchConfig()
  }
})

const handleFileChange =async (event) => {
  const params = new FormData()
  params.append('file', event.target.files[0])
  params.append('type', '1')
  loading.value = true
  // å…ˆæ£€æŸ¥é‚®ç®±æ˜¯å¦å­˜åœ¨
  // const res = await getRequest("/registration/check_email", {
  //   email: form.value.email,
  // });
  // if (!res.email) {
  //   const ok = await captchaRef.value?.show();
  //   if (!ok) return;
  // }
  postUploadApi(params).then(res=>{
    loading.value = false
    form.value.fileUrl = res
    ElMessage.success({ message: 'ä¸Šä¼ æˆåŠŸ' })
  }).catch(err=>{
    loading.value = false
  })
}

const handleSubmit = () => {
  // TODO: å®ç°æ–‡ä»¶ä¸Šä¼ å’Œè¡¨å•æäº¤é€»è¾‘
  if(!form.value.fileUrl){
    ElMessage.error({ message: 'è¯·ä¸Šä¼ æŠ¥å‘Šæ–‡ä»¶' })
    return
  }
  postAddThesisApi(form.value).then(res=>{
    ElMessage.success({ message: "ä¿å­˜æˆåŠŸ" })
    form.value = {
      year: '2025',
      title: '',
      submitType: '',
      authors: '',
      abstract: '',
      keywords: '',
      fileUrl:'',
      email:form.value.email
    }
    const input = document.getElementById('file')
    input.value = ''
  }).catch(err=>{
    ElMessage.error({ message: "ä¿å­˜å¤±è´¥" })
  })
}
</script>

<style scoped>
.submission-container {
  padding: 2rem;
  max-width: 1200px;
  margin: 0 auto;
}

.content-wrapper {
  background: #fff;
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

h1 {
  font-size: 2rem;
  color: #333;
  margin-bottom: 2rem;
  text-align: center;
}

h2 {
  font-size: 1.5rem;
  color: #444;
  margin: 2rem 0 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

h3 {
  font-size: 1.2rem;
  color: #555;
  margin: 1.5rem 0 1rem;
}

h4 {
  font-size: 1.1rem;
  color: #666;
  margin: 1rem 0 0.5rem;
}

.cfp-section {
  margin-bottom: 3rem;
}

.cfp-content {
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 6px;
}

.topics ul {
  list-style-type: none;
  padding-left: 1.5rem;
  margin: 1rem 0;
}

.topics li {
  position: relative;
  margin: 0.7rem 0;
  color: #666;
  padding-left: 0.5rem;
}

.topics li::before {
  content: "â€¢";
  position: absolute;
  left: -1rem;
  color: #1890ff;
}

.topics .highlight-topic {
  padding-left: 0.8rem;
  color: #2ecc71;
  font-weight: 500;
}

.topics .highlight-topic::before {
  color: #2ecc71;
}

.requirements {
  margin-top: 2rem;
}

.general-requirement {
  margin: 0.5rem 0 1.5rem;
  color: #666;
  font-weight: 500;
  padding-left: 0.5rem;
  border-left: 3px solid #1890ff;
}

.requirement-item {
  margin: 1.5rem 0;
  padding: 1rem;
  background: white;
  border-radius: 4px;
  border: 1px solid #eee;
}

.requirement-item ul {
  list-style-type: none;
  padding-left: 1.5rem;
  margin: 0.5rem 0;
}

.requirement-item li {
  position: relative;
  margin: 0.5rem 0;
  color: #666;
}

.requirement-item li::before {
  content: "â€¢";
  position: absolute;
  left: -1rem;
  color: #1890ff;
}

.template-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: #1890ff;
  color: white;
  border-radius: 4px;
  text-decoration: none;
  margin-top: 0.5rem;
  transition: background 0.3s;
}

.template-btn:hover {
  background: #40a9ff;
}

.submission-form {
  margin-top: 2rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

label {
  display: block;
  margin-bottom: 0.5rem;
  color: #666;
}

input[type="text"],
select,
textarea {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 1rem;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

.file-upload {
  border: 2px dashed #ddd;
  padding: 1.5rem;
  text-align: center;
  border-radius: 4px;
  background: #fafafa;
}

.file-hint {
  margin: 0.5rem 0 0;
  color: #999;
  font-size: 0.9rem;
}

.form-actions {
  margin-top: 2rem;
  text-align: center;
}

.submit-btn {
  padding: 0.8rem 2rem;
  background: #1890ff;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
}

.submit-btn:hover {
  background: #40a9ff;
}

@media (max-width: 768px) {
  .submission-container {
    padding: 1rem;
  }

  .content-wrapper {
    padding: 1rem;
  }

  h1 {
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
  }

  h2 {
    font-size: 1.3rem;
    margin: 1.5rem 0 1rem;
  }

  h3 {
    font-size: 1.1rem;
    margin: 1.2rem 0 0.8rem;
  }

  h4 {
    font-size: 1rem;
    margin: 0.8rem 0 0.4rem;
  }

  .cfp-section {
    margin-bottom: 2rem;
  }

  .cfp-content {
    padding: 1rem;
  }

  .topics ul {
    padding-left: 1.2rem;
    margin: 0.8rem 0;
  }

  .topics li {
    margin: 0.5rem 0;
    font-size: 0.95rem;
  }

  .requirements {
    margin-top: 1.5rem;
  }

  .general-requirement {
    margin: 0.4rem 0 1.2rem;
    font-size: 0.95rem;
  }

  .requirement-item {
    margin: 1.2rem 0;
    padding: 0.8rem;
  }

  .requirement-item ul {
    padding-left: 1.2rem;
    margin: 0.4rem 0;
  }

  .requirement-item li {
    margin: 0.4rem 0;
    font-size: 0.95rem;
  }

  .template-btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.95rem;
  }

  .form-group {
    margin-bottom: 1.2rem;
  }

  label {
    font-size: 0.95rem;
    margin-bottom: 0.4rem;
  }

  input[type="text"],
  select,
  textarea {
    padding: 0.4rem;
    font-size: 0.95rem;
  }

  .file-upload {
    padding: 1.2rem;
  }

  .file-hint {
    font-size: 0.85rem;
  }

  .submit-btn {
    padding: 0.6rem 1.5rem;
    font-size: 0.95rem;
  }
}

@media (max-width: 480px) {
  .submission-container {
    padding: 0.8rem;
  }

  .content-wrapper {
    padding: 0.8rem;
  }

  h1 {
    font-size: 1.6rem;
    margin-bottom: 1.2rem;
  }

  h2 {
    font-size: 1.2rem;
    margin: 1.2rem 0 0.8rem;
  }

  h3 {
    font-size: 1rem;
    margin: 1rem 0 0.6rem;
  }

  .cfp-content {
    padding: 0.8rem;
  }

  .topics li {
    font-size: 0.9rem;
  }

  .requirement-item {
    padding: 0.6rem;
  }

  .requirement-item li {
    font-size: 0.9rem;
  }

  .template-btn {
    width: 100%;
    justify-content: center;
    padding: 0.5rem;
    box-sizing: border-box;
    margin: 0.5rem 0;
  }

  .form-group {
    margin-bottom: 1rem;
    width: 100%;
  }

  label {
    font-size: 0.9rem;
  }

  input[type="text"],
  select,
  textarea {
    width: 100%;
    box-sizing: border-box;
    font-size: 0.9rem;
    padding: 0.5rem;
  }

  .file-upload {
    padding: 1rem;
    width: 100%;
    box-sizing: border-box;
  }

  .file-upload input[type="file"] {
    width: 100%;
    box-sizing: border-box;
  }

  .file-hint {
    font-size: 0.8rem;
  }

  .submit-btn {
    width: 100%;
    padding: 0.5rem;
  }
}

.guidelines-content {
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 6px;
}

.guideline-item {
  margin: 1.5rem 0;
  padding: 1rem;
  background: white;
  border-radius: 4px;
  border: 1px solid #eee;
}

.guideline-item:first-child {
  margin-top: 0;
}

.date-list {
  list-style-type: none;
  padding-left: 0;
}

.date-list li {
  margin: 0.8rem 0;
  display: flex;
  flex-wrap: wrap;
}

.date-label {
  font-weight: 500;
  min-width: 120px;
  color: #555;
}

.date-value {
  color: #f06292;
  font-weight: 500;
}

.guideline-item p {
  margin: 0.5rem 0;
  color: #666;
}

.guideline-item ul, .guideline-item ol {
  padding-left: 1.5rem;
  margin: 0.8rem 0;
}

.guideline-item li {
  margin: 0.5rem 0;
  color: #666;
}

@media (max-width: 768px) {
  .guidelines-content {
    padding: 1rem;
  }

  .guideline-item {
    padding: 0.8rem;
  }

  .date-list li {
    flex-direction: column;
  }

  .date-label {
    margin-bottom: 0.2rem;
  }
}
</style>
